<div class="client-orders-container">
  <!-- Header Section -->
  <div class="orders-header">
    <h1>My Orders</h1>
    <div class="header-actions">
      <button class="btn-primary" routerLink="/marketplace/browse-services">
        <i class="fas fa-plus"></i> New Order
      </button>
      <button class="btn-secondary" routerLink="/marketplace/client-dashboard">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="statistics-grid">
    <div class="stat-card">
      <div class="stat-icon blue">
        <i class="fas fa-shopping-bag"></i>
      </div>
      <div class="stat-content">
        <h3>{{ statistics.totalOrders }}</h3>
        <p>Total Orders</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon orange">
        <i class="fas fa-spinner"></i>
      </div>
      <div class="stat-content">
        <h3>{{ statistics.activeOrders }}</h3>
        <p>Active Orders</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon green">
        <i class="fas fa-check-double"></i>
      </div>
      <div class="stat-content">
        <h3>{{ statistics.completedOrders }}</h3>
        <p>Completed</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon purple">
        <i class="fas fa-dollar-sign"></i>
      </div>
      <div class="stat-content">
        <h3>${{ statistics.totalSpent | number:'1.2-2' }}</h3>
        <p>Total Spent</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon yellow">
        <i class="fas fa-clock"></i>
      </div>
      <div class="stat-content">
        <h3>{{ statistics.pendingDeliveries }}</h3>
        <p>Pending Deliveries</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon red">
        <i class="fas fa-redo"></i>
      </div>
      <div class="stat-content">
        <h3>{{ statistics.inRevision }}</h3>
        <p>In Revision</p>
      </div>
    </div>
  </div>

  <!-- Filters and Sorting -->
  <div class="filters-section">
    <div class="filter-group">
      <label>Filter by Status:</label>
      <select [(ngModel)]="filterStatus" (change)="filterOrders()">
        <option value="all">All Orders</option>
        <option value="pending">Pending</option>
        <option value="in_progress">In Progress</option>
        <option value="delivered">Delivered</option>
        <option value="completed">Completed</option>
        <option value="revision">Under Revision</option>
        <option value="cancelled">Cancelled</option>
        <option value="disputed">Disputed</option>
      </select>
    </div>

    <div class="filter-group">
      <label>Sort by:</label>
      <select [(ngModel)]="sortBy" (change)="sortOrders()">
        <option value="date">Order Date</option>
        <option value="delivery">Delivery Date</option>
        <option value="price">Price</option>
        <option value="status">Status</option>
      </select>
    </div>

    <div class="search-box">
      <i class="fas fa-search"></i>
      <input type="text" placeholder="Search orders...">
    </div>
  </div>

  <!-- Orders Grid -->
  <div class="orders-grid">
    <!-- Orders List -->
    <div class="orders-list">
      <div *ngFor="let order of filteredOrders"
           class="order-card"
           [class.selected]="selectedOrder?.id === order.id"
           (click)="selectOrder(order)">

        <div class="order-header">
          <div class="order-info">
            <h3>{{ order.serviceTitle }}</h3>
            <p class="order-id">Order #{{ order.id }}</p>
          </div>
          <div class="status-badges">
            <span class="order-status" [ngClass]="getStatusClass(order.status)">
              {{ order.status | titlecase }}
            </span>
            <span class="payment-status" [ngClass]="getPaymentStatusClass(order.paymentStatus)">
              <i class="fas fa-credit-card"></i>
              {{ order.paymentStatus | titlecase }}
            </span>
          </div>
        </div>

        <div class="freelancer-info">
          <img [src]="order.freelancerAvatar" [alt]="order.freelancerName" class="freelancer-avatar">
          <div>
            <span class="freelancer-name">{{ order.freelancerName }}</span>
            <div class="rating" *ngIf="order.freelancerRating">
              <i class="fas fa-star"></i>
              <span>{{ order.freelancerRating }}</span>
            </div>
          </div>
          <span class="package-badge" *ngIf="order.packageType">
            {{ order.packageType | titlecase }}
          </span>
        </div>

        <div class="order-details">
          <div class="detail-row">
            <span class="label">Order Date:</span>
            <span>{{ order.orderDate | date:'MMM dd, yyyy' }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Delivery:</span>
            <span [class.urgent]="getDaysRemaining(order.deliveryDate) < 3 && order.status === 'in_progress'">
              {{ order.deliveryDate | date:'MMM dd, yyyy' }}
              <span *ngIf="order.status === 'in_progress'" class="days-remaining">
                ({{ getDaysRemaining(order.deliveryDate) }} days left)
              </span>
            </span>
          </div>
          <div class="detail-row">
            <span class="label">Amount:</span>
            <span class="price">${{ order.price | number:'1.2-2' }}</span>
          </div>
          <div class="detail-row" *ngIf="order.revisionCount !== undefined">
            <span class="label">Revisions:</span>
            <span>{{ order.revisionCount }}/{{ order.maxRevisions }}</span>
          </div>
        </div>

        <div class="order-actions">
          <button *ngIf="order.status === 'delivered'"
                  class="btn-sm btn-success"
                  (click)="approveDelivery(order.id); $event.stopPropagation()">
            <i class="fas fa-check"></i> Approve
          </button>
          <button *ngIf="order.status === 'delivered' && order.revisionCount < order.maxRevisions"
                  class="btn-sm btn-warning"
                  (click)="requestRevision(order.id); $event.stopPropagation()">
            <i class="fas fa-redo"></i> Request Revision
          </button>
          <button *ngIf="order.status === 'completed'"
                  class="btn-sm btn-primary"
                  (click)="reorderService(order.id); $event.stopPropagation()">
            <i class="fas fa-sync"></i> Reorder
          </button>
          <button class="btn-sm btn-secondary"
                  (click)="navigateToOrderDetails(order.id); $event.stopPropagation()">
            <i class="fas fa-eye"></i> View Details
          </button>
        </div>
      </div>

      <div *ngIf="filteredOrders.length === 0" class="no-orders">
        <i class="fas fa-shopping-cart"></i>
        <h3>No orders found</h3>
        <p>Start by browsing services and placing your first order</p>
        <button class="btn-primary" routerLink="/marketplace/browse-services">
          Browse Services
        </button>
      </div>
    </div>

    <!-- Order Details Panel -->
    <div class="order-details-panel" *ngIf="selectedOrder">
      <div class="panel-header">
        <h2>Order Details</h2>
        <button class="btn-close" (click)="selectedOrder = null">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="panel-content">
        <!-- Order Overview -->
        <div class="detail-section">
          <h3>{{ selectedOrder.serviceTitle }}</h3>
          <p class="order-id">Order #{{ selectedOrder.id }}</p>

          <div class="status-info">
            <div class="status-badge" [ngClass]="getStatusClass(selectedOrder.status)">
              <i class="fas fa-info-circle"></i>
              Status: {{ selectedOrder.status | titlecase }}
            </div>
            <div class="payment-badge" [ngClass]="getPaymentStatusClass(selectedOrder.paymentStatus)">
              <i class="fas fa-credit-card"></i>
              Payment: {{ selectedOrder.paymentStatus | titlecase }}
            </div>
          </div>
        </div>

        <!-- Freelancer Information -->
        <div class="detail-section">
          <h4>Freelancer</h4>
          <div class="freelancer-detail">
            <img [src]="selectedOrder.freelancerAvatar" [alt]="selectedOrder.freelancerName" class="freelancer-avatar-large">
            <div>
              <p class="freelancer-name">{{ selectedOrder.freelancerName }}</p>
              <div class="freelancer-rating" *ngIf="selectedOrder.freelancerRating">
                <i class="fas fa-star"></i>
                <span>{{ selectedOrder.freelancerRating }} Rating</span>
              </div>
            </div>
            <button class="btn-message">
              <i class="fas fa-comment"></i> Message
            </button>
          </div>
        </div>

        <!-- Order Timeline -->
        <div class="detail-section" *ngIf="selectedOrder.timeline && selectedOrder.timeline.length > 0">
          <h4>Order Timeline</h4>
          <div class="timeline">
            <div *ngFor="let event of selectedOrder.timeline" class="timeline-item">
              <div class="timeline-marker"></div>
              <div class="timeline-content">
                <div class="timeline-header">
                  <span class="event-name">{{ event.event }}</span>
                  <span class="event-time">{{ event.timestamp | date:'short' }}</span>
                </div>
                <p *ngIf="event.description" class="event-description">{{ event.description }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Deliverables -->
        <div class="detail-section" *ngIf="selectedOrder.deliverables && selectedOrder.deliverables.length > 0">
          <h4>Deliverables</h4>
          <div class="deliverables-list">
            <div *ngFor="let deliverable of selectedOrder.deliverables" class="deliverable-item">
              <i class="fas" [ngClass]="getFileIcon(deliverable.fileType)"></i>
              <div class="file-info">
                <span class="file-name">{{ deliverable.name }}</span>
                <span class="file-meta">{{ formatFileSize(deliverable.fileSize) }} • {{ deliverable.uploadedAt | date:'short' }}</span>
              </div>
              <button (click)="downloadDeliverable(deliverable)" class="btn-download">
                <i class="fas fa-download"></i> Download
              </button>
            </div>
          </div>
        </div>

        <!-- Messages Section -->
        <div class="detail-section">
          <h4>Messages</h4>
          <div class="messages-container">
            <div class="messages-list" *ngIf="selectedOrder.messages && selectedOrder.messages.length > 0">
              <div *ngFor="let message of selectedOrder.messages"
                   class="message"
                   [class.client-message]="message.sender === 'client'"
                   [class.freelancer-message]="message.sender === 'freelancer'"
                   [class.unread]="!message.isRead && message.sender === 'freelancer'">
                <div class="message-header">
                  <span class="sender">
                    {{ message.sender === 'client' ? 'You' : selectedOrder.freelancerName }}
                  </span>
                  <span class="timestamp">{{ message.timestamp | date:'short' }}</span>
                </div>
                <p class="message-content">{{ message.content }}</p>
                <div class="message-attachments" *ngIf="message.attachments && message.attachments.length > 0">
                  <span *ngFor="let attachment of message.attachments" class="attachment">
                    <i class="fas fa-paperclip"></i> {{ attachment }}
                  </span>
                </div>
              </div>
            </div>

            <div *ngIf="!selectedOrder.messages || selectedOrder.messages.length === 0" class="no-messages">
              <p>No messages yet. Start a conversation with your freelancer.</p>
            </div>

            <div class="message-input">
              <textarea [(ngModel)]="newMessage"
                        placeholder="Type your message..."
                        rows="3"></textarea>
              <div class="message-actions">
                <button class="btn-attach">
                  <i class="fas fa-paperclip"></i>
                </button>
                <button (click)="sendMessage()" class="btn-send" [disabled]="!newMessage.trim()">
                  <i class="fas fa-paper-plane"></i> Send
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="panel-actions">
          <button *ngIf="selectedOrder.status === 'delivered'"
                  class="btn-primary"
                  (click)="approveDelivery(selectedOrder.id)">
            <i class="fas fa-check"></i> Approve & Complete
          </button>

          <button *ngIf="selectedOrder.status === 'delivered' && selectedOrder.revisionCount < selectedOrder.maxRevisions"
                  class="btn-warning"
                  (click)="requestRevision(selectedOrder.id)">
            <i class="fas fa-redo"></i> Request Revision
            <span class="revision-count">({{ selectedOrder.maxRevisions - selectedOrder.revisionCount }} left)</span>
          </button>

          <button *ngIf="selectedOrder.status === 'in_progress'"
                  class="btn-info"
                  (click)="extendDeliveryTime(selectedOrder.id)">
            <i class="fas fa-calendar-plus"></i> Extend Time
          </button>

          <button *ngIf="selectedOrder.status === 'completed'"
                  class="btn-success"
                  (click)="tipFreelancer(selectedOrder.id)">
            <i class="fas fa-gift"></i> Send Tip
          </button>

          <button *ngIf="selectedOrder.status === 'completed'"
                  class="btn-primary"
                  (click)="reorderService(selectedOrder.id)">
            <i class="fas fa-sync"></i> Order Again
          </button>

          <button *ngIf="selectedOrder.status === 'delivered' || selectedOrder.status === 'in_progress'"
                  class="btn-danger"
                  (click)="disputeOrder(selectedOrder.id)">
            <i class="fas fa-exclamation-triangle"></i> Dispute Order
          </button>

          <button *ngIf="selectedOrder.status === 'pending'"
                  class="btn-danger"
                  (click)="cancelOrder(selectedOrder.id)">
            <i class="fas fa-times-circle"></i> Cancel Order
          </button>

          <button class="btn-secondary"
                  (click)="contactSupport(selectedOrder.id)">
            <i class="fas fa-headset"></i> Contact Support
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Rating Modal -->
  <div class="modal" *ngIf="showRatingModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Rate Your Experience</h2>
        <button class="btn-close" (click)="showRatingModal = false">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form [formGroup]="ratingForm" (ngSubmit)="submitRating()">
        <div class="modal-body">
          <div class="rating-group">
            <label>Overall Rating</label>
            <div class="star-rating">
              <i *ngFor="let star of [1,2,3,4,5]"
                 class="fas fa-star"
                 [class.active]="ratingForm.get('overall')?.value >= star"
                 (click)="ratingForm.patchValue({overall: star})"></i>
            </div>
          </div>

          <div class="rating-group">
            <label>Communication</label>
            <div class="star-rating">
              <i *ngFor="let star of [1,2,3,4,5]"
                 class="fas fa-star"
                 [class.active]="ratingForm.get('communication')?.value >= star"
                 (click)="ratingForm.patchValue({communication: star})"></i>
            </div>
          </div>

          <div class="rating-group">
            <label>Service Quality</label>
            <div class="star-rating">
              <i *ngFor="let star of [1,2,3,4,5]"
                 class="fas fa-star"
                 [class.active]="ratingForm.get('serviceQuality')?.value >= star"
                 (click)="ratingForm.patchValue({serviceQuality: star})"></i>
            </div>
          </div>

          <div class="rating-group">
            <label>Delivery Time</label>
            <div class="star-rating">
              <i *ngFor="let star of [1,2,3,4,5]"
                 class="fas fa-star"
                 [class.active]="ratingForm.get('delivery')?.value >= star"
                 (click)="ratingForm.patchValue({delivery: star})"></i>
            </div>
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" formControlName="wouldRecommend">
              Would you recommend this freelancer?
            </label>
          </div>

          <div class="form-group">
            <label>Your Review (Optional)</label>
            <textarea formControlName="review"
                      rows="4"
                      placeholder="Share your experience with this freelancer..."></textarea>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" (click)="showRatingModal = false">
            Cancel
          </button>
          <button type="submit" class="btn-primary" [disabled]="!ratingForm.valid">
            Submit Rating
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
